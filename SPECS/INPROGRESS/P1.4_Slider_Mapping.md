# PRD: P1.4 — Implement Slider → Params Mapping

**Version:** 1.0.0
**Phase:** P1 (FilterCore)
**Task:** Implement slider → params mapping
**Track:** macOS
**Priority:** High
**Effort:** Medium
**Dependencies:** P1.3 (Preset mapping implementation)
**Parallelizable:** Yes (Can run parallel to P1.5, P1.6)
**Status:** In Progress

## Overview

Implement a mapping function to convert slider positions to filter parameters. This will allow users to fine-tune the filtering behavior using a slider interface.

## Context

- Part of the FilterCore implementation (P1)
- Required for P3.5 (Stability slider UI)
- Should provide smooth and intuitive control over filtering strength
- Must integrate with the preset system (P1.3)

## Task Breakdown

### 1. Define Mapping Function
- Research and define a mapping function from slider position (0.0 to 1.0) to filter parameters
- Ensure the mapping is smooth and intuitive
- Cover the full range of filtering strengths (from minimal to aggressive)

### 2. Implement Mapping Logic
- Create a function to convert slider position to filter parameters
- Ensure the mapping is invertible (can convert parameters back to slider position)
- Provide smooth transitions between preset values

### 3. Integration with One Euro Filter
- Modify the OneEuroFilter class to accept slider-based parameters
- Ensure slider changes are applied smoothly without causing jumps in output
- Validate that slider changes work correctly with preset switching

### 4. Unit Testing
- Write unit tests for slider mapping
- Verify that slider positions map to expected parameter ranges
- Ensure smooth transitions between slider positions

## Test Cases (from TestPlan.md)

### Unit Tests
- **Slider mapping validation**
  - Slider position 0.0 maps to minimal filtering parameters
  - Slider position 1.0 maps to aggressive filtering parameters
  - Intermediate positions map to appropriate intermediate parameters

- **Smooth transitions**
  - Small changes in slider position result in small changes in parameters
  - No sudden jumps in output when adjusting slider

### Integration Tests
- **Slider and preset interaction**
  - Slider adjustments work correctly with all presets
  - Switching presets doesn't reset slider position
  - Slider position is preserved across preset changes

## Acceptance Criteria

- ✓ Slider mapping function implemented and tested
- ✓ Smooth and intuitive control over filtering strength
- ✓ Integration with OneEuroFilter validated
- ✓ All unit tests pass (100% coverage)
- ✓ Slider works correctly with preset system

## Quality Checklist

- [ ] Mapping function defined and documented
- [ ] Slider mapping implemented and tested
- [ ] Integration with OneEuroFilter validated
- [ ] Unit tests written and passing
- [ ] Code reviewed and approved

## Implementation Templates

### Slider Mapping Function
```swift
extension OneEuroFilter {
    /// Maps slider position to filter parameters
    ///
    /// - Parameter sliderPosition: The slider position (0.0 to 1.0)
    /// - Returns: Filter parameters (minCutoff, beta, derivativeCutoff)
    public static func parametersForSliderPosition(_ sliderPosition: Double) -> (minCutoff: Double, beta: Double, derivativeCutoff: Double) {
        // Implement mapping logic here
        // Example: linear mapping
        let minCutoff = 1.0 + sliderPosition * 2.0
        let beta = 0.1 + sliderPosition * 0.4
        let derivativeCutoff = 1.0 + sliderPosition * 2.0
        return (minCutoff, beta, derivativeCutoff)
    }

    /// Maps filter parameters to slider position
    ///
    /// - Returns: Slider position (0.0 to 1.0)
    public func sliderPosition() -> Double {
        // Implement inverse mapping logic here
        // Example: average of normalized parameters
        let normalizedMinCutoff = (minCutoff - 1.0) / 2.0
        let normalizedBeta = (beta - 0.1) / 0.4
        let normalizedDerivativeCutoff = (derivativeCutoff - 1.0) / 2.0
        return (normalizedMinCutoff + normalizedBeta + normalizedDerivativeCutoff) / 3.0
    }
}
```

### Unit Test Stub
```swift
func testSliderMapping() {
    // Test slider position 0.0 (minimal filtering)
    let minimalParams = OneEuroFilter.parametersForSliderPosition(0.0)
    XCTAssertEqual(minimalParams.minCutoff, 1.0, accuracy: 0.01)
    XCTAssertEqual(minimalParams.beta, 0.1, accuracy: 0.01)
    XCTAssertEqual(minimalParams.derivativeCutoff, 1.0, accuracy: 0.01)

    // Test slider position 1.0 (aggressive filtering)
    let aggressiveParams = OneEuroFilter.parametersForSliderPosition(1.0)
    XCTAssertEqual(aggressiveParams.minCutoff, 3.0, accuracy: 0.01)
    XCTAssertEqual(aggressiveParams.beta, 0.5, accuracy: 0.01)
    XCTAssertEqual(aggressiveParams.derivativeCutoff, 3.0, accuracy: 0.01)

    // Test intermediate position
    let intermediateParams = OneEuroFilter.parametersForSliderPosition(0.5)
    XCTAssertEqual(intermediateParams.minCutoff, 2.0, accuracy: 0.01)
    XCTAssertEqual(intermediateParams.beta, 0.3, accuracy: 0.01)
    XCTAssertEqual(intermediateParams.derivativeCutoff, 2.0, accuracy: 0.01)
}

func testSliderSmoothness() {
    let filter = OneEuroFilter(preset: .balanced)

    // Test small changes in slider position
    let params1 = OneEuroFilter.parametersForSliderPosition(0.5)
    let params2 = OneEuroFilter.parametersForSliderPosition(0.51)

    // Verify small changes result in small parameter differences
    XCTAssertLessThan(abs(params2.minCutoff - params1.minCutoff), 0.1)
    XCTAssertLessThan(abs(params2.beta - params1.beta), 0.1)
    XCTAssertLessThan(abs(params2.derivativeCutoff - params1.derivativeCutoff), 0.1)
}
```

## Next Steps

1. Define slider mapping function
2. Implement mapping logic in OneEuroFilter
3. Write unit tests for slider mapping
4. Validate integration with preset system
5. Commit changes and push for review
6. Proceed to EXECUTE phase

## References

- `SPECS/PRD/Workplan.md` — Master task list
- `SPECS/PRD/TestPlan.md` — QA testing strategy
- `SPECS/RULES/01_PRD_PROMPT.md` — PRD generation rules